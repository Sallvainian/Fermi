{
  "metadata": {
    "version": 1,
    "root": "C:\\Users\\frank\\Projects\\Fermi",
    "createdAt": "2025-09-05T04:40:53.957Z",
    "updatedAt": "2025-09-05T04:53:00.187Z",
    "totalFiles": 21
  },
  "tree": {
    "name": "Fermi",
    "type": "dir",
    "children": [
      {
        "name": "functions",
        "type": "dir",
        "children": [
          {
            "name": "lib",
            "type": "dir",
            "children": [
              {
                "name": "types",
                "type": "dir",
                "children": [
                  {
                    "name": "oauth.types.js",
                    "type": "file"
                  }
                ]
              },
              {
                "name": "cleanup.js",
                "type": "file"
              },
              {
                "name": "createTestStudent.js",
                "type": "file"
              },
              {
                "name": "customClaims.js",
                "type": "file"
              },
              {
                "name": "index.js",
                "type": "file"
              },
              {
                "name": "migrate-user-roles-cloud.js",
                "type": "file"
              },
              {
                "name": "migrate-user-roles.js",
                "type": "file"
              },
              {
                "name": "oauth.js",
                "type": "file"
              },
              {
                "name": "rate-limiter.js",
                "type": "file"
              },
              {
                "name": "security.js",
                "type": "file"
              }
            ]
          },
          {
            "name": "src",
            "type": "dir",
            "children": [
              {
                "name": "types",
                "type": "dir",
                "children": [
                  {
                    "name": "oauth.types.ts",
                    "type": "file"
                  }
                ]
              },
              {
                "name": "cleanup.ts",
                "type": "file"
              },
              {
                "name": "customClaims.ts",
                "type": "file"
              },
              {
                "name": "index.ts",
                "type": "file"
              },
              {
                "name": "migrate-user-roles-cloud.ts",
                "type": "file"
              },
              {
                "name": "migrate-user-roles.ts",
                "type": "file"
              },
              {
                "name": "oauth.ts",
                "type": "file"
              },
              {
                "name": "rate-limiter.ts",
                "type": "file"
              },
              {
                "name": "security.ts",
                "type": "file"
              }
            ]
          },
          {
            "name": "cloudflare-email-worker.js",
            "type": "file"
          }
        ]
      },
      {
        "name": "src",
        "type": "dir",
        "children": [
          {
            "name": "index.js",
            "type": "file"
          }
        ]
      }
    ]
  },
  "nodes": [
    "functions/cloudflare-email-worker.js",
    "functions/lib/cleanup.js",
    "functions/lib/createTestStudent.js",
    "functions/lib/customClaims.js",
    "functions/lib/index.js",
    "functions/lib/migrate-user-roles-cloud.js",
    "functions/lib/migrate-user-roles.js",
    "functions/lib/oauth.js",
    "functions/lib/rate-limiter.js",
    "functions/lib/security.js",
    "functions/lib/types/oauth.types.js",
    "functions/src/cleanup.ts",
    "functions/src/customClaims.ts",
    "functions/src/index.ts",
    "functions/src/migrate-user-roles-cloud.ts",
    "functions/src/migrate-user-roles.ts",
    "functions/src/oauth.ts",
    "functions/src/rate-limiter.ts",
    "functions/src/security.ts",
    "functions/src/types/oauth.types.ts",
    "src/index.js"
  ],
  "edges": [
    {
      "from": "functions/lib/index.js",
      "to": "functions/lib/cleanup.js"
    },
    {
      "from": "functions/lib/index.js",
      "to": "functions/lib/createTestStudent.js"
    },
    {
      "from": "functions/lib/index.js",
      "to": "functions/lib/customClaims.js"
    },
    {
      "from": "functions/lib/index.js",
      "to": "functions/lib/migrate-user-roles-cloud.js"
    },
    {
      "from": "functions/lib/index.js",
      "to": "functions/lib/oauth.js"
    },
    {
      "from": "functions/src/index.ts",
      "to": "functions/src/cleanup.ts"
    },
    {
      "from": "functions/src/index.ts",
      "to": "functions/src/customClaims.ts"
    },
    {
      "from": "functions/src/index.ts",
      "to": "functions/src/migrate-user-roles-cloud.ts"
    },
    {
      "from": "functions/src/index.ts",
      "to": "functions/src/oauth.ts"
    },
    {
      "from": "functions/src/oauth.ts",
      "to": "functions/src/security.ts"
    },
    {
      "from": "functions/src/security.ts",
      "to": "functions/src/rate-limiter.ts"
    },
    {
      "from": "functions\\src\\index.ts",
      "to": "functions/src/cleanup.ts"
    },
    {
      "from": "functions\\src\\index.ts",
      "to": "functions/src/customClaims.ts"
    },
    {
      "from": "functions\\src\\index.ts",
      "to": "functions/src/migrate-user-roles-cloud.ts"
    },
    {
      "from": "functions\\src\\index.ts",
      "to": "functions/src/oauth.ts"
    }
  ],
  "files": {
    "functions/cloudflare-email-worker.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": []
    },
    "functions/lib/cleanup.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "scheduler_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "manualPKCECleanup",
          "initKind": "function",
          "isExported": false
        }
      ]
    },
    "functions/lib/createTestStudent.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "https_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "db",
          "initKind": "unknown",
          "isExported": false
        }
      ]
    },
    "functions/lib/customClaims.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "https_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "firestore_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "v2_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        }
      ]
    },
    "functions/lib/index.js": {
      "imports": [
        {
          "from": "./customClaims",
          "kind": "require"
        },
        {
          "from": "./oauth",
          "kind": "require"
        },
        {
          "from": "./cleanup",
          "kind": "require"
        },
        {
          "from": "./migrate-user-roles-cloud",
          "kind": "require"
        },
        {
          "from": "./createTestStudent",
          "kind": "require"
        }
      ],
      "dependencies": [
        "functions/lib/cleanup.js",
        "functions/lib/createTestStudent.js",
        "functions/lib/customClaims.js",
        "functions/lib/migrate-user-roles-cloud.js",
        "functions/lib/oauth.js"
      ],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "firebase_functions_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        }
      ]
    },
    "functions/lib/migrate-user-roles-cloud.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "v2_1",
          "initKind": "unknown",
          "isExported": false
        }
      ]
    },
    "functions/lib/migrate-user-roles.js": {
      "imports": [],
      "dependencies": [],
      "functions": [
        {
          "name": "migrateUserRoles",
          "params": [],
          "isAsync": true,
          "isExported": false
        }
      ],
      "classes": [],
      "constants": [
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        }
      ]
    },
    "functions/lib/oauth.js": {
      "imports": [],
      "dependencies": [],
      "functions": [
        {
          "name": "fetchWithTimeout",
          "params": [
            {
              "name": "url"
            },
            {
              "name": "options"
            },
            {
              "name": "timeoutMs"
            }
          ],
          "isAsync": true,
          "isExported": false
        }
      ],
      "classes": [],
      "constants": [
        {
          "name": "https_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "params_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "crypto",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "security_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "googleClientId",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "googleClientSecret",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "GOOGLE_AUTH_URL",
          "initKind": "literal",
          "isExported": false
        },
        {
          "name": "GOOGLE_TOKEN_URL",
          "initKind": "literal",
          "isExported": false
        },
        {
          "name": "GOOGLE_USERINFO_URL",
          "initKind": "literal",
          "isExported": false
        },
        {
          "name": "FETCH_TIMEOUT_MS",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "getPKCECollection",
          "initKind": "function",
          "isExported": false
        }
      ]
    },
    "functions/lib/rate-limiter.js": {
      "imports": [],
      "dependencies": [],
      "functions": [
        {
          "name": "cleanupOldRateLimitRecords",
          "params": [
            {
              "name": "firestore"
            },
            {
              "name": "hoursToKeep"
            }
          ],
          "isAsync": true,
          "isExported": false
        }
      ],
      "classes": [
        {
          "name": "FirestoreRateLimiter",
          "isExported": false,
          "methods": [
            {
              "name": "withFirestoreBackend",
              "params": [
                {
                  "name": "config"
                },
                {
                  "name": "firestore"
                }
              ],
              "isAsync": false,
              "isStatic": true
            },
            {
              "name": "rejectOnQuotaExceededOrRecordUsage",
              "params": [
                {
                  "name": "identifier"
                }
              ],
              "isAsync": true
            }
          ],
          "properties": []
        }
      ],
      "constants": [
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        }
      ]
    },
    "functions/lib/security.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "admin",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "https_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "rate_limiter_1",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "createRateLimiter",
          "initKind": "function",
          "isExported": false
        },
        {
          "name": "applyRateLimit",
          "initKind": "function",
          "isExported": false
        },
        {
          "name": "applySecurityHeaders",
          "initKind": "function",
          "isExported": false
        },
        {
          "name": "getClientIdentifier",
          "initKind": "function",
          "isExported": false
        }
      ]
    },
    "functions/lib/types/oauth.types.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": []
    },
    "functions/src/cleanup.ts": {
      "imports": [
        {
          "from": "firebase-functions/v2/scheduler",
          "kind": "import",
          "imported": [
            "onSchedule"
          ]
        },
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        }
      ],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "cleanupExpiredPKCEChallenges",
          "initKind": "unknown",
          "isExported": true
        },
        {
          "name": "manualPKCECleanup",
          "initKind": "function",
          "isExported": true
        }
      ]
    },
    "functions/src/customClaims.ts": {
      "imports": [
        {
          "from": "firebase-functions/v2/https",
          "kind": "import",
          "imported": [
            "onCall",
            "HttpsError"
          ]
        },
        {
          "from": "firebase-functions/v2/firestore",
          "kind": "import",
          "imported": [
            "onDocumentWritten"
          ]
        },
        {
          "from": "firebase-functions/v2",
          "kind": "import",
          "imported": [
            "logger"
          ]
        },
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        }
      ],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "setRoleClaim",
          "initKind": "unknown",
          "isExported": true
        },
        {
          "name": "syncUserRole",
          "initKind": "unknown",
          "isExported": true
        }
      ]
    },
    "functions/src/index.ts": {
      "imports": [
        {
          "from": "firebase-functions",
          "kind": "import",
          "imported": [
            "setGlobalOptions"
          ]
        },
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        },
        {
          "from": "./customClaims",
          "kind": "export"
        },
        {
          "from": "./oauth",
          "kind": "export"
        },
        {
          "from": "./cleanup",
          "kind": "export"
        },
        {
          "from": "./migrate-user-roles-cloud",
          "kind": "export"
        },
        {
          "from": "./createTestStudent",
          "kind": "export"
        }
      ],
      "dependencies": [
        "functions/src/cleanup.ts",
        "functions/src/customClaims.ts",
        "functions/src/migrate-user-roles-cloud.ts",
        "functions/src/oauth.ts"
      ],
      "functions": [],
      "classes": [],
      "constants": []
    },
    "functions/src/migrate-user-roles-cloud.ts": {
      "imports": [
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        },
        {
          "from": "firebase-functions/v2",
          "kind": "import",
          "imported": [
            "https"
          ]
        }
      ],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "migrateAllUserRoles",
          "initKind": "unknown",
          "isExported": true
        }
      ]
    },
    "functions/src/migrate-user-roles.ts": {
      "imports": [
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        }
      ],
      "dependencies": [],
      "functions": [
        {
          "name": "migrateUserRoles",
          "params": [],
          "isAsync": true,
          "isExported": false
        }
      ],
      "classes": [],
      "constants": []
    },
    "functions/src/oauth.ts": {
      "imports": [
        {
          "from": "firebase-functions/v2/https",
          "kind": "import",
          "imported": [
            "onRequest",
            "HttpsError"
          ]
        },
        {
          "from": "firebase-functions/params",
          "kind": "import",
          "imported": [
            "defineSecret"
          ]
        },
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        },
        {
          "from": "crypto",
          "kind": "import",
          "isNamespace": true
        },
        {
          "from": "./security",
          "kind": "import",
          "imported": [
            "oauthRateLimiters",
            "applyRateLimit",
            "oauthValidator",
            "applySecurityHeaders",
            "getClientIdentifier"
          ]
        },
        {
          "from": "./types/oauth.types",
          "kind": "import",
          "imported": [
            "GoogleTokenResponse",
            "GoogleUserInfo",
            "PKCEChallenge",
            "OAuthCodeExchangeRequest",
            "OAuthTokenRefreshRequest"
          ]
        }
      ],
      "dependencies": [
        "functions/src/security.ts"
      ],
      "functions": [
        {
          "name": "fetchWithTimeout",
          "params": [
            {
              "name": "url",
              "type": "string"
            },
            {
              "name": "options",
              "type": "RequestInit"
            },
            {
              "name": "timeoutMs",
              "type": "number"
            }
          ],
          "isAsync": true,
          "isExported": false,
          "returnType": "Promise<Response>"
        }
      ],
      "classes": [],
      "constants": [
        {
          "name": "googleClientId",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "googleClientSecret",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "GOOGLE_AUTH_URL",
          "initKind": "literal",
          "isExported": false
        },
        {
          "name": "GOOGLE_TOKEN_URL",
          "initKind": "literal",
          "isExported": false
        },
        {
          "name": "GOOGLE_USERINFO_URL",
          "initKind": "literal",
          "isExported": false
        },
        {
          "name": "FETCH_TIMEOUT_MS",
          "initKind": "unknown",
          "isExported": false
        },
        {
          "name": "getPKCECollection",
          "initKind": "function",
          "isExported": false
        },
        {
          "name": "getOAuthUrl",
          "initKind": "unknown",
          "isExported": true
        },
        {
          "name": "exchangeOAuthCode",
          "initKind": "unknown",
          "isExported": true
        },
        {
          "name": "refreshOAuthToken",
          "initKind": "unknown",
          "isExported": true
        }
      ]
    },
    "functions/src/rate-limiter.ts": {
      "imports": [
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        }
      ],
      "dependencies": [],
      "functions": [
        {
          "name": "cleanupOldRateLimitRecords",
          "params": [
            {
              "name": "firestore",
              "type": "admin.firestore.Firestore"
            },
            {
              "name": "hoursToKeep",
              "type": "number"
            }
          ],
          "isAsync": true,
          "isExported": true,
          "returnType": "Promise<void>"
        }
      ],
      "classes": [
        {
          "name": "FirestoreRateLimiter",
          "isExported": true,
          "methods": [
            {
              "name": "withFirestoreBackend",
              "params": [
                {
                  "name": "config",
                  "type": "RateLimiterConfig"
                },
                {
                  "name": "firestore",
                  "type": "admin.firestore.Firestore"
                }
              ],
              "isAsync": false,
              "returnType": "FirestoreRateLimiter",
              "isStatic": true
            },
            {
              "name": "rejectOnQuotaExceededOrRecordUsage",
              "params": [
                {
                  "name": "identifier",
                  "type": "string"
                }
              ],
              "isAsync": true,
              "returnType": "Promise<void>"
            }
          ],
          "properties": [
            {
              "name": "config",
              "type": "RateLimiterConfig",
              "isPrivate": true
            },
            {
              "name": "firestore",
              "type": "admin.firestore.Firestore",
              "isPrivate": true
            },
            {
              "name": "collectionName",
              "isPrivate": true
            }
          ]
        }
      ],
      "constants": []
    },
    "functions/src/security.ts": {
      "imports": [
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        },
        {
          "from": "firebase-functions/v2/https",
          "kind": "import",
          "imported": [
            "HttpsError"
          ]
        },
        {
          "from": "./rate-limiter",
          "kind": "import",
          "imported": [
            "FirestoreRateLimiter"
          ]
        },
        {
          "from": "express",
          "kind": "import",
          "imported": [
            "Request",
            "Response"
          ]
        }
      ],
      "dependencies": [
        "functions/src/rate-limiter.ts"
      ],
      "functions": [],
      "classes": [],
      "constants": [
        {
          "name": "createRateLimiter",
          "initKind": "function",
          "isExported": true
        },
        {
          "name": "oauthRateLimiters",
          "initKind": "object",
          "isExported": true
        },
        {
          "name": "applyRateLimit",
          "initKind": "function",
          "isExported": true
        },
        {
          "name": "oauthValidator",
          "initKind": "object",
          "isExported": true,
          "type": "OAuthRequestValidation"
        },
        {
          "name": "securityHeaders",
          "initKind": "object",
          "isExported": true
        },
        {
          "name": "applySecurityHeaders",
          "initKind": "function",
          "isExported": true
        },
        {
          "name": "getClientIdentifier",
          "initKind": "function",
          "isExported": true
        }
      ]
    },
    "functions/src/types/oauth.types.ts": {
      "imports": [
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        }
      ],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": []
    },
    "src/index.js": {
      "imports": [],
      "dependencies": [],
      "functions": [],
      "classes": [],
      "constants": []
    },
    "functions\\src\\index.ts": {
      "imports": [
        {
          "from": "firebase-functions",
          "kind": "import",
          "imported": [
            "setGlobalOptions"
          ]
        },
        {
          "from": "firebase-admin",
          "kind": "import",
          "isNamespace": true
        },
        {
          "from": "./customClaims",
          "kind": "export"
        },
        {
          "from": "./oauth",
          "kind": "export"
        },
        {
          "from": "./cleanup",
          "kind": "export"
        },
        {
          "from": "./migrate-user-roles-cloud",
          "kind": "export"
        }
      ],
      "dependencies": [
        "functions/src/cleanup.ts",
        "functions/src/customClaims.ts",
        "functions/src/migrate-user-roles-cloud.ts",
        "functions/src/oauth.ts"
      ],
      "functions": [],
      "classes": [],
      "constants": []
    }
  }
}