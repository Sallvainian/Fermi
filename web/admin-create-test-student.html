<!DOCTYPE html>
<html>
<head>
  <title>Create Test Student - Fermi Admin</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: 600;
    }
    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 4px;
      display: none;
    }
    .success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    .info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
    .credentials {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
    }
    code {
      background: #f4f4f4;
      padding: 2px 5px;
      border-radius: 3px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Create Test Student Account</h1>
    
    <form id="createForm">
      <div class="form-group">
        <label for="username">Username</label>
        <input type="text" id="username" value="teststudent" required>
      </div>
      
      <div class="form-group">
        <label for="password">Password</label>
        <input type="text" id="password" value="Test123!" required>
      </div>
      
      <div class="form-group">
        <label for="firstName">First Name</label>
        <input type="text" id="firstName" value="Test" required>
      </div>
      
      <div class="form-group">
        <label for="lastName">Last Name</label>
        <input type="text" id="lastName" value="Student" required>
      </div>
      
      <button type="submit" id="createBtn">Create Test Student</button>
    </form>
    
    <div id="result" class="result"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBl_36NLwN3O9POk5SMD86jX_LGY1IDFrM",
      authDomain: "teacher-dashboard-flutterfire.firebaseapp.com",
      projectId: "teacher-dashboard-flutterfire",
      storageBucket: "teacher-dashboard-flutterfire.firebasestorage.app",
      messagingSenderId: "218352465432",
      appId: "1:218352465432:web:4254a98138547b7138b56d"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const functions = firebase.functions();

    // Function to show result
    function showResult(message, type) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = 'result ' + type;
      resultDiv.innerHTML = message;
      resultDiv.style.display = 'block';
    }

    // Handle form submission
    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('createBtn');
      btn.disabled = true;
      btn.textContent = 'Creating...';
      
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      
      try {
        // First, sign in as admin (you need to be signed in with admin privileges)
        showResult('Please sign in with an admin account first...', 'info');
        
        // For production, you'd want proper admin authentication
        // For now, we'll try to call the Cloud Function if it exists
        const createTestStudent = functions.httpsCallable('createTestStudent');
        
        try {
          const result = await createTestStudent();
          
          if (result.data.success) {
            showResult(`
              <strong>✅ Test student created successfully!</strong>
              <div class="credentials">
                <strong>Login Credentials:</strong><br>
                Username: <code>${result.data.credentials.username}</code><br>
                Password: <code>${result.data.credentials.password}</code><br>
                UID: <code>${result.data.credentials.uid}</code>
              </div>
            `, 'success');
          }
        } catch (funcError) {
          // If Cloud Function doesn't exist, try direct creation (needs admin auth)
          console.log('Cloud Function not available, trying direct creation...');
          
          // This would only work if you're authenticated as an admin user
          // with custom claims or if security rules allow it
          
          const syntheticEmail = `${username}@students.fermi-app.local`;
          
          // Try to create auth user (this will likely fail without admin SDK)
          showResult(`
            <strong>⚠️ Cannot create from browser directly</strong><br>
            To create the test student, you need to either:<br>
            1. Deploy the Cloud Function (run <code>firebase deploy --only functions</code>)<br>
            2. Run the Node.js script with admin credentials<br>
            3. Use Firebase Console to manually create the user<br><br>
            <strong>Manual Steps:</strong><br>
            1. Go to Firebase Console > Authentication<br>
            2. Add user with email: <code>${syntheticEmail}</code><br>
            3. Set password: <code>${password}</code><br>
            4. Copy the generated UID<br>
            5. Go to Firestore > users collection<br>
            6. Create document with ID = the UID from step 4<br>
            7. Add fields: username="${username}", role="student", etc.
          `, 'info');
        }
        
      } catch (error) {
        console.error('Error:', error);
        showResult(`
          <strong>❌ Error:</strong> ${error.message}<br><br>
          <strong>Alternative: Manual Creation</strong><br>
          See instructions above for manual creation in Firebase Console.
        `, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Create Test Student';
      }
    });
  </script>
</body>
</html>